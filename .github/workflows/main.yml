name: Safe Auto Commit Changes

on:
  push:
    branches: [main]
  workflow_dispatch:         # Allow manual run from GitHub UI
  schedule:
    - cron: '0 * * * *'      # Optional: run once every hour

jobs:
  auto-commit:
    if: github.actor != 'github-actions[bot]'  # 🚫 Prevent loop
    runs-on: ubuntu-latest

    steps:
      - name: ⬇️ Checkout Repo
        uses: actions/checkout@v4
        with:
          persist-credentials: false  # Required for safer push action

      - name: 🛠 Setup Git Identity
        run: |
          git config --global user.name "RapidFlashUSDT Bot"
          git config --global user.email "bot@flashusdtsender.xyz"

      - name: 🚧 Safe File Update (example only)
        run: |
          mkdir -p logs
          echo "Last sync: $(date -u)" >> logs/auto-sync.log

      - name: ✅ Check for Actual Changes
        id: check_changes
        run: |
          git add .
          git diff --cached --quiet && echo "no_changes=true" >> $GITHUB_OUTPUT || echo "no_changes=false" >> $GITHUB_OUTPUT

      - name: ✅ Commit and Push if Changed
        if: steps.check_changes.outputs.no_changes == 'false'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "🤖 Safe Auto-commit: $(date -u +'%Y-%m-%d %H:%M UTC')"
          branch: main
          commit_user_name: RapidFlashUSDT Bot
          commit_user_email: bot@flashusdtsender.xyz
